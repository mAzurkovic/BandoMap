
<!-- <form action="/add" method="POST">
  <input type="text" placeholder="address" name="address">
  <button type="submit">Add location</button>
</form> -->
<div id="map"></div>
<div class="container">

  <div class="row">
    <form class="col s12" action="/add" method="POST">
      <div class="row">
        <div class="input-field col s3">
          <input id="address" type="text" name="address" class="validate">
          <label for="address">Address</label>
        </div>
        <div class="input-field col s3">
          <input id="city" type="text" name="city" class="validate">
          <label for="city">City</label>
        </div>

        <label>Spot Type</label>
        <select class="browser-default" name="type">
          <option value="" disabled selected>Spot Type</option>
          <option value="Field" name="field">Field</option>
          <option value="Park" name="park">Park</option>
          <option value="Forest" name="forest">Forest</option>
          <option value="Parking Lot (Outdoor)" name="parkingLotOut">Parking Lot (Outdoor)</option>
          <option value="Parking Lot (Indoor)" name="parkingLotIn">Parking Lot (Indoor)</option>
          <option value="Building(s)" name="buildings">Building(s)</option>
          <option value="Other" name="other">Other</option>
        </select>

        <select class="browser-default" name="goodFor">
          <option value="" disabled selected>Good For</option>
          <option value="Racing" name="racing">Racing</option>
          <option value="Freestyle" name="freestyle">Freestyle</option>
          <option value="Longrange" name="longrange">Longrange</option>
          <option value="Everything" name="everything">Everything</option>
        </select>
        Has an outlet?
        <p>
          <input name="yes" type="radio" id="test1" />
          <label for="test1">Yes</label>
        </p>
        <p>
          <input name="no" type="radio" id="test2" />
          <label for="test2">No</label>
        </p>

      </div>
      <button class="btn waves-effect waves-light" type="submit" name="action">Add Spot
        <i class="material-icons right">send</i>
    </button>
    </form>
  </div>
</div>

<script type="text/javascript">
var map, infoWindow;
var spots = {{{spots}}}; // this is the location data from the database

function initMap() {
  latLng = new google.maps.LatLng(49, 123)

  map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: -34.397, lng: 150.644},
    zoom: 8
  });
  infoWindow = new google.maps.InfoWindow;

  // Try HTML5 geolocation.
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var pos = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };

      map.setCenter(pos);
    }, function() {
      handleLocationError(true, infoWindow, map.getCenter());
    });
  } else {
    // Browser doesn't support Geolocation
    handleLocationError(false, infoWindow, map.getCenter());
  }

  /* map.addListener('click', function(e) {
   placeMarkerAndPanTo(e.latLng, map);
 }); */

  for (var i = 0; i < spots.length; i++) { // loop through all the locations and render a marker
    console.log(spots[i].coords);
    addMarker(spots[i].coords, spots[i].address, spots[i]._id, spots[i].points);
  }

}

function handleLocationError(browserHasGeolocation, infoWindow, pos) {
  infoWindow.setPosition(pos);
  infoWindow.setContent(browserHasGeolocation ?
                        'Error: The Geolocation service failed.' :
                        'Error: Your browser doesn\'t support geolocation.');
  infoWindow.open(map);
}

// adds a marker on map when user clicks on a place on the map
function placeMarkerAndPanTo(latLng, map) {
  var marker = new google.maps.Marker({
    position: latLng,
    map: map
  });
  map.panTo(latLng);
}

// adds a marker as well as an info box containing the rating of the spot
function addMarker(coords, address, id, points) {

  var upvote = "/upvote/" + id;
  // string that is used to render the html in the info box
  var contentString = '<div id="content">'+
             '<div id="siteNotice">'+
             '</div>'+
             '<h5 id="firstHeading" class="firstHeading">' + address + '</h5>'+
             '<h5><form action="/upvote/'+ id +'" method="POST"><input type="submit" name="upvote" value="↑"/></form>'+ points +
             '<form action="/downvote/'+ id +'" method="POST"><input type="submit" name="upvote" value="↓"/></form></h5>' +
             '<div id="bodyContent">'+
             '</div>'+
             '</div>';

  var infowindow = new google.maps.InfoWindow({
    content: contentString
  });

  var marker = new google.maps.Marker({
     position: coords,
     map: map,
     visible: true
  });

  marker.addListener('click', function() {
    infowindow.open(map, marker);
  });

}

</script>

<!-- Reference javascripts for Google Maps API -->
<!--<script type="text/javascript" src="/javascripts/googleMaps.js"></script>-->
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBktahDyXxT0XCyMnbgb0yftsMmJ4rlN1k&callback=initMap"></script>
